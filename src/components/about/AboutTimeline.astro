---
// src/components/about/AboutTimeline.astro
import aboutTimeline1 from '@/assets/images/about/about-timeline-1.jpg'
import aboutTimeline2 from '@/assets/images/about/about-timeline-2.jpg'

interface SlideImage {
    src: string
    modifier?: string
}

interface TimelineSlide {
    id: number
    year: string
    title: string
    description: string
    images: SlideImage[]
}

const slides: TimelineSlide[] = [
    {
        id: 1,
        year: '1996',
        title: 'Открытие',
        description:
            'мы создаём путешествия мечты, помогая тысячам туристов открывать мир с комфортом и удовольствием Доверили нам свои впечатления –и мы сделали их путешествия по-настоящему незабываемыми',
        images: [
            { src: aboutTimeline1.src },
            { src: aboutTimeline2.src, modifier: '_pos-top-1 _pos-right' },
        ],
    },
    {
        id: 2,
        year: '2005',
        title: 'Расширение',
        description: 'Контент для 2005 года будет добавлен позже',
        images: [{ src: 'https://placehold.co/828x540/CCA870/00273F?text=2005' }],
    },
    {
        id: 3,
        year: '2009',
        title: 'Развитие',
        description: 'Контент для 2009 года будет добавлен позже',
        images: [
            {
                src: 'https://placehold.co/414x309/CCA870/00273F?text=2009-1',
                modifier: '_pos-top-1',
            },
            { src: 'https://placehold.co/390x240/CCA870/00273F?text=2009-2', modifier: '_pos-right' },
            {
                src: 'https://placehold.co/300x200/CCA870/00273F?text=2009-3',
                modifier: '_pos-center',
            },
        ],
    },
    {
        id: 4,
        year: '2012',
        title: 'Новые горизонты',
        description: 'Контент для 2012 года будет добавлен позже',
        images: [{ src: 'https://placehold.co/414x309/CCA870/00273F?text=2012' }],
    },
    {
        id: 5,
        year: '2018',
        title: 'Инновации',
        description: 'Контент для 2018 года будет добавлен позже',
        images: [
            { src: 'https://placehold.co/414x309/CCA870/00273F?text=2018-1' },
            { src: 'https://placehold.co/390x240/CCA870/00273F?text=2018-2' },
        ],
    },
    {
        id: 6,
        year: '2021',
        title: 'Цифровизация',
        description: 'Контент для 2021 года будет добавлен позже',
        images: [{ src: 'https://placehold.co/414x309/CCA870/00273F?text=2021' }],
    },
    {
        id: 7,
        year: '2025',
        title: 'Будущее',
        description: 'Контент для 2025 года будет добавлен позже',
        images: [{ src: 'https://placehold.co/414x309/CCA870/00273F?text=2025' }],
    },
]
---

<section class="about-timeline">
    <div class="timeline-container">
        <div class="timeline-content">
            {
                slides.map((slide, index) => (
                    <div
                        class:list={['timeline-slide', { _active: index === 0 }]}
                        data-slide-index={index}
                    >
                        <button
                            class:list={['timeline-dot', { _active: index === 0 }]}
                            data-year={slide.year}
                            data-index={index}
                            aria-label={`Перейти к ${slide.year} году`}
                        >
                            <span class="dot-circle" />
                            <span class="dot-year">{slide.year}</span>
                        </button>

                        <div class="slide-content">
                            <div class="slide-images">
                                {slide.images.map((image, imgIndex) => (
                                    <div class:list={['slide-image', image.modifier]}>
                                        <img
                                            src={image.src}
                                            alt={`${slide.title} - фото ${imgIndex + 1}`}
                                            loading="lazy"
                                        />
                                    </div>
                                ))}
                            </div>
                            <div class="slide-text">
                                <h2 class="slide-title">{slide.title}</h2>
                                <p class="slide-description">{slide.description}</p>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>

        <div class="timeline-nav-desktop">
            <div class="timeline-line"></div>
        </div>
    </div>
</section>

<style lang="scss" is:global>
    .about-timeline {
        background: $color-globus-blue;
        @include adaptive(margin-top, 120, 60);
        @include adaptive(padding-top, 80, 60);
        @include adaptive(padding-bottom, 80, 10);
        overflow: hidden;

        .timeline-container {
            position: relative;
            width: 100%;
            @include side-paddings;
            display: flex;
            flex-direction: column;
            @include adaptive(gap, 60, 40);
        }

        .timeline-content {
            position: relative;
            width: 100%;
            display: flex;
            flex-direction: column;

            @include desktop {
                @include adaptive(min-height, 424, 424);
            }
        }

        .timeline-slide {
            position: relative;
            display: none;
            width: 100%;
            @include adaptive(gap, 72, 30);
            transition: opacity 0.5s ease;

            .timeline-dot {
                display: none;
                position: absolute;
                left: 0;
                top: 0;
                flex-direction: row;

                @include mobile {
                    display: flex;
                }
            }

            &._active {
                display: flex;
                animation: fadeIn 0.5s ease forwards;

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                    }
                    to {
                        opacity: 1;
                    }
                }

                .slide-content {
                    max-height: fit-content;

                    .slide-images,
                    .slide-text {
                        opacity: 1;
                    }
                }
            }

            &:last-child {
                .slide-content {
                    border: none;
                }
            }

            @include mobile {
                display: flex;
                flex-direction: row;
                @include adaptive(margin-top, -4, -4);
                @include adaptive(padding-top, 16, 16);
                @include adaptive(padding-left, 12, 12);
            }
        }

        .slide-content {
            display: contents;

            @include mobile {
                display: flex;
                flex-direction: column;
                @include adaptive(gap, 30, 30);
                @include adaptive(padding-top, 50, 50);
                @include adaptive(padding-left, 30, 30);
                @include adaptive(padding-bottom, 34, 34);
                max-height: 0;
                overflow: hidden;
                transition:
                    opacity 0.3s ease,
                    max-height 0.5s ease;
                border-left: 2px solid $color-globus-cream;

                .slide-images,
                .slide-text {
                    opacity: 0;
                }
            }
        }

        .slide-text {
            display: flex;
            flex-direction: column;
            @include adaptive(gap, 26, 20);
            width: 46%;

            @include mobile {
                width: 93%;
                order: 1;
            }
        }

        .slide-title {
            color: $color-globus-cream;
            text-align: left;
        }

        .slide-description {
            @include font-circe-light;
            @include adaptive(font-size, 26, 18);
            line-height: 1.21;
            color: $color-globus-cream;
            opacity: 0.6;
            width: 94%;

            @include mobile {
                width: 100%;
            }
        }

        .slide-images {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            @include adaptive(gap, 44, 20);
            align-items: flex-start;
            width: 50%;

            @include mobile {
                flex-direction: column;
                width: 100%;
                order: 2;
            }
        }

        .slide-image {
            position: relative;
            overflow: hidden;
            @include adaptive(max-width, auto, 272);

            img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }

            &._pos-right {
                margin-left: auto;
            }

            &._pos-center {
                margin: 0 auto;
            }

            &._pos-top-1 {
                @include adaptive(margin-top, 150, 0);
            }
        }

        .timeline-nav-desktop {
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            @include adaptive(min-height, 73, 40);

            @include mobile {
                display: none;
            }
        }

        .timeline-line {
            @include center-x;
            @include adaptive(top, 13, 13);
            width: 96%;
            height: 2px;
            background: $color-globus-cream;
        }

        .timeline-dot {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            @include adaptive(gap, 14, 14);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 1;
            transition: all 0.3s ease;

            &:hover {
                .dot-circle {
                    transform: scale(1.2);
                }
            }

            &._active {
                pointer-events: none;
                cursor: default;
                .dot-circle {
                    background: $color-globus-sand;
                    border-color: $color-globus-sand;
                }

                .dot-year {
                    opacity: 1;
                    color: $color-globus-sand;
                }
            }
        }

        .dot-circle {
            @include adaptive(width, 28, 26);
            @include adaptive(height, 28, 26);
            border-radius: 50%;
            background: $color-globus-blue;
            border: 2px solid $color-globus-cream;
            transition: all 0.3s ease;
        }

        .dot-year {
            @include font-circe-light;
            @include adaptive(font-size, 26, 26);
            line-height: 1.2;
            color: $color-globus-cream;
            opacity: 0.6;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
    }
</style>
