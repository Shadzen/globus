---
// src/components/common/Header.astro
import Logo from './Logo.astro'
import dotsIcon from '@/assets/icons/dots.svg'
const base = import.meta.env.BASE_URL

interface Props {
    userType?: 'tourist' | 'agent'
    heroTextColor?: 'light' | 'dark'
}

const { userType = 'tourist', heroTextColor = 'light' } = Astro.props
---

<header class:list={[{ '_dark-text': heroTextColor === 'dark' }]}>
    <div class="header-container">
        <Logo userType={userType} color={heroTextColor === 'dark' ? 'dark' : 'light'} />

        <div class="header-actions">
            <div class:list={["user-type", `_${userType}`]}>
                <a href={`${base}tourist/`} class:list={["user-type-btn", { "_active": userType === 'tourist' }]}>Турист</a>
                <a href={`${base}agent/`} class:list={["user-type-btn", { "_active": userType === 'agent' }]}>Агент</a>
            </div>

            <nav class="nav-menu">
                {userType === 'agent' && (
                    <a href="#">Кыргызстан</a>
                )}
                <a href={`${base}${userType}/about`}>О нас</a>
                <a href={`${base}tourist/tourvisor`}>Поиск тура и отеля</a>
                <a href={`${base}${userType}/news`}>Глобус-News</a>
                {userType === 'tourist' ? (
                    <>
                        <a href="#">Коллекции туров</a>
                        <a href={`${base}tourist/best_hotels`}>Лучшие отели мира</a>
                        <a href={`${base}tourist/mice`}>Деловой туризм</a>
                    </>
                ) : (
                    <>
                        <a href={`${base}agent/partner`}>Стать партнером</a>
                        <a href={`${base}agent/countries`}>Страны</a>
                    </>
                )}
            </nav>

            <div class="contacts">
                <a href="#" class="dots-btn">
                    <img src={dotsIcon.src} alt="" />
                </a>

                <a href="#" class="contact-btn">Связаться с нами</a>

                <a href="tel:+73832000500" class="phone">+7 383 2000 500</a>
            </div>
        </div>

        <button class="mobile-menu-btn" type="button" aria-label="Открыть меню">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</header>

<style lang="scss" is:global>
    header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        --menu-animation-duration: 0.3s;

        @media (min-aspect-ratio: 21/9) {
            padding: 0 12.5%;
        }

        .header-container {
            position: relative;
            width: 100%;
            @include flex-center;
            flex-direction: column;
            @include adaptive(gap, 26, 26);
            @include adaptive(padding-top, 54, 30);
            @include adaptive(padding-bottom, 34, 20);
            @include side-paddings;

            @include mobile {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        .header-actions {
            position: relative;
            width: 100%;
            @include flex-center-between;
            flex-shrink: 0;
            @include mobile {
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                width: 100dvw;
                height: 100dvh;
                @include side-paddings;
                @include adaptive(padding-top, 110, 110);
                @include adaptive(padding-bottom, 40, 40);
                flex-direction: column;
                background-color: $color-alternate;
                z-index: 999;
                transform: translateX(100%);
                transition: transform var(--menu-animation-duration) ease-in-out;

                &._active {
                    transform: translateX(0);
                }
            }
        }

        .user-type {
            @include flex-center-between;
            border-style: solid;
            border-color: $color-accent;
            @include adaptive(border-width, 2, 2);
            border-radius: 50px;

            &._tourist {
                border-left: none;
            }

            &._agent {
                border-right: none;
            }

            @include mobile {
                width: 100%;
            }
        }

        .user-type-btn {
            @include flex-center;
            @include adaptive(padding-top, 6, 8);
            @include adaptive(padding-bottom, 6, 8);
            @include adaptive(padding-left, 18, 18);
            @include adaptive(padding-right, 18, 18);
            border-radius: 50px;
            @include font-circe-regular;
            @include adaptive(font-size, 18, 22);
            line-height: 1.3;
            color: $color-main;
            background: transparent;
            transition: all 0.3s;
            opacity: 0.4;

            &._active {
                background: $color-accent;
                opacity: 1;
            }

            &:hover {
                opacity: 1;
            }

            @include mobile {
                width: 50%;
            }
        }

        .nav-menu {
            position: relative;
            @include flex-center-between;
            @include adaptive(gap, 30, 20);

            @include desktop {
                @include adaptive(padding-left, 50, 50);
                @include adaptive(padding-right, 50, 50);
                flex: 1;
            }

            @include mobile {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                @include adaptive(padding-top, 30, 30);
                @include adaptive(padding-bottom, 30, 30);
                // @include adaptive(gap, 36, 36);
            }

            a {
                @include font-circe-regular;
                @include adaptive(font-size, 20, 22);
                line-height: 1.2;
                color: $color-main;
                opacity: 0.6;
                transition: opacity 0.3s;

                @include mobile {
                    // @include adaptive(font-size, 24, 20);
                    // text-align: center;
                    width: 100%;
                    color: #fff;
                    opacity: 1;
                    border-bottom: 1px solid $color-accent;
                    line-height: 2.2;
                }

                &:hover {
                    opacity: 1;
                }
            }
        }

        .contacts {
            position: relative;
            @include flex-center-between;
            @include adaptive(gap, 18, 18);

            @include mobile {
                // flex-direction: column;
                justify-content: flex-start;
                flex-wrap: wrap;
                width: 100%;
                @include adaptive(gap, 30, 30);
                // margin-top: 20px;
            }
        }

        .dots-btn {
            display: block;
            @include adaptive(width, 40, 40);
            @include adaptive(height, 40, 40);

            img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            @include mobile {
                order: 1;
            }
        }

        .contact-btn {
            @include flex-center;
            @include adaptive(padding-top, 6, 6);
            @include adaptive(padding-bottom, 6, 6);
            @include adaptive(padding-left, 18, 18);
            @include adaptive(padding-right, 18, 18);

            border-style: solid;
            border-color: $color-accent;
            @include adaptive(border-width, 2, 2);
            // @include adaptive(border-radius, 25, 25);
            border-radius: 50px;

            background: $color-accent;
            @include font-circe-regular;
            @include adaptive(font-size, 20, 18);
            line-height: 1.2;
            color: $color-main;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;

            &:hover {
                opacity: 0.8;
            }

            @include mobile {
                order: 3;
                width: 100%;
                @include adaptive(height, 60, 60);
                text-transform: uppercase;
                @include adaptive(letter-spacing, 3, 3);
            }
        }

        .phone {
            @include font-kudry-sans;
            @include adaptive(font-size, 28, 28);
            font-weight: 300;
            line-height: 1.2;
            color: $color-main;
            text-transform: uppercase;

            @include mobile {
                order: 2;
            }
        }

        .mobile-menu-btn {
            // Размеры для расчёта
            $btn-height: 50;
            $btn-padding: 10;
            $line-height: 3;
            $lines-count: 3;

            // Автоматический расчёт смещения
            $content-height: $btn-height - ($btn-padding * 2); // 30
            $total-lines-height: $line-height * $lines-count; // 9
            $gap-space: $content-height - $total-lines-height; // 21
            $gap-between: calc($gap-space / 2); // 10.5
            $translate-distance: calc($line-height / 2) + $gap-between + calc($line-height / 2); // 13.5
            $translate-percent: calc($translate-distance / $line-height) * 100%; // 450%

            display: none;
            flex-direction: column;
            justify-content: space-between;
            @include adaptive(width, 62, 62);
            @include adaptive(height, $btn-height, $btn-height);
            @include adaptive(padding, $btn-padding, $btn-padding);
            cursor: pointer;
            z-index: 1001;

            // Сброс стилей кнопки
            background: none;
            border: none;

            &:focus {
                outline: transparent;
            }

            @include mobile {
                display: flex;
            }

            span {
                display: block;
                width: 100%;
                @include adaptive(height, $line-height, $line-height);
                background-color: $color-main;
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                transition: background-color var(--menu-animation-duration) ease-in-out;

                &:nth-child(2) {
                    transition: opacity 0.1s ease, background-color var(--menu-animation-duration) ease-in-out;
                }
            }

            // Состояние когда меню открыто
            &._active {
                span:nth-child(1) {
                    animation: topLineToX var(--menu-animation-duration) ease-in-out forwards;
                }

                span:nth-child(2) {
                    opacity: 0;
                    transition-delay: calc(var(--menu-animation-duration) / 2);
                }

                span:nth-child(3) {
                    animation: bottomLineToX var(--menu-animation-duration) ease-in-out forwards;
                }
            }

            // Состояние закрытия (анимация назад) - только если кнопка уже использовалась
            &._initialized:not(._active) {
                span:nth-child(1) {
                    animation: topLineFromX var(--menu-animation-duration) ease-in-out forwards;
                }

                span:nth-child(2) {
                    opacity: 1;
                    transition-delay: calc(var(--menu-animation-duration) / 2);
                }

                span:nth-child(3) {
                    animation: bottomLineFromX var(--menu-animation-duration) ease-in-out forwards;
                }
            }

            @keyframes topLineToX {
                0% {
                    transform: translateY(0) rotate(0deg);
                }
                50% {
                    transform: translateY($translate-percent) rotate(0deg);
                }
                100% {
                    transform: translateY($translate-percent) rotate(45deg);
                }
            }

            @keyframes bottomLineToX {
                0% {
                    transform: translateY(0) rotate(0deg);
                }
                50% {
                    transform: translateY(-$translate-percent) rotate(0deg);
                }
                100% {
                    transform: translateY(-$translate-percent) rotate(-45deg);
                }
            }

            @keyframes topLineFromX {
                0% {
                    transform: translateY($translate-percent) rotate(45deg);
                }
                50% {
                    transform: translateY($translate-percent) rotate(0deg);
                }
                100% {
                    transform: translateY(0) rotate(0deg);
                }
            }

            @keyframes bottomLineFromX {
                0% {
                    transform: translateY(-$translate-percent) rotate(-45deg);
                }
                50% {
                    transform: translateY(-$translate-percent) rotate(0deg);
                }
                100% {
                    transform: translateY(0) rotate(0deg);
                }
            }
        }

        // Темный цвет текста для страниц со светлым фоном hero
        &._dark-text {
            .user-type-btn {
                &:not(._active) {
                    color: $color-alternate;

                    @include mobile {
                        color: $color-main;
                    }
                }
            }

            .nav-menu {
                a {
                    color: $color-alternate;

                    @include mobile {
                        color: #fff;
                    }
                }
            }

            .phone {
                color: $color-alternate;

                @include mobile {
                    color: $color-main;
                }
            }

            .mobile-menu-btn {
                @include mobile {
                    // Когда меню закрыто - темные полоски
                    span {
                        background-color: $color-alternate;
                    }

                    // Когда меню открыто - светлые полоски
                    &._active span {
                        background-color: $color-main;
                    }

                    // Когда меню закрывается - обратно темные
                    &._initialized:not(._active) span {
                        background-color: $color-alternate;
                    }
                }
            }
        }
    }
</style>
